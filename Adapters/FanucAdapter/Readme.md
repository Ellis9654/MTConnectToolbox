
#Notes on MTConnect Fanuc Adapter 
----

Friday, October 21, 201610/21/2016 9:27 AM
Brief overview of MTConnect Fanuc Adapter for Fanuc Iseries control.
#Upgrade from VS2008 (VC9) to VSC++ Community Edition
1) No boost - version not detected or known
Fortunately, the code did no rely on boost and was in there to replace windows threading model, but was never used.

2) Old code had MSVC versioning - removed
3) Used #elif define() for LAN vs HSSB

	#ifdef iSERIESLAN
	#pragma message("Compile Iseries with Fwlib/e1  - Lan")
	#include "Fwlib/e1/fwlib32.h"
	
	#elif defined(iSERIESHSSB)
	#ifdef i160
	#pragma message("Compile Iseries with 160i  - HSSB")
	#include "Fwlib/160/fwlib32.h"
	#else
	#pragma message("Compile Iseries with 30i  - HSSB")
	#include "Fwlib/30i/fwlib32.h"
	#endif
	#else
	#pragma message("No Iseries to compile")
	#error  No Iseries to compile
	#endif

4) fwlib unsafe
Fwlib32.lib(Fwlib32.dll) : error LNK2026: module unsafe for SAFESEH image.
Disabling option "Image has Safe Exception Handlers" in Project properties -> Configuration Properties -> Linker -> Advanced tab helped me NO!
From: http://stackoverflow.com/questions/10599940/module-unsafe-for-safeseh-image-c
5) calling _set_se_translator() requires /EHa
Project Properties -> Compiler -> Code Generation -> Enable C++ Exceptions -> Yes with SEH Exceptions (/EHa)
6) Changed output name to FanucShdr in Project Properties -> Output Name
#Modifications Required to compile Source Code
This section assumes you have installed VS 2015 community edition, and downloaded the Fanuc Shdr Adapter code from github using either git clone or extracting from a zip file.
 1. You will need to change the following code to your lib path:

	#define FANUCLIBPATH(X)    "C:\\Users\\michalos\\Documents\\Visual Studio 2015\\Projects\\FanucAdapter\\" ## X

Found in file iSeries.cpp
 2. Visual Studio 2010 was used to build the msi program for installation. According to MS this is the last version that havs support for MSI project. If you have VS 2010, uou will need to copy the Shdr.exe from the compilation into the Distribution folder. Depending on whether it is a LAN or HSSB implementation you may want to change the properties in Visual Studio 2010 . Then Build the setup. The custom dll is not used. Use of the NIS installer has not been done. It is more flexible, but doesn't seem to uninstall as robustly. Merge modules are especially hard to use also â€“ the VC runtime.

#Installation
Run MSI.  It will install a service as either MTConnectHSSBAdapter or MTConnectLANAdapter. It is installed as a Manual service. 
 1. You will need to manually start to make sure it runs. If it runs, change Manual to Automatic.
 2. Unless you have the fwlib.dll you will get an error as below:

<CENTER>
![Figure1](./images/image1.jpg?raw=true)
</CENTER>

Closeup:
<CENTER>
![Figure2](./images/image2.jpg?raw=true)
</CENTER>

Autogenerated from Microsoft Word by [Word2Markdown](https://github.com/johnmichaloski/SoftwareGadgets/tree/master/Word2Markdown)